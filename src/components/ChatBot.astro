---
import { Image } from "astro:assets";
import whatsapp from "../../public/images/icons/whatsapp.svg";
---

<div
  class="fixed right-0 bottom-0 size-full z-40 xs:h-[640px] xs:w-[440px] 3xl:h-[800px] flex flex-col items-end justify-end"
  id="Chatbot"
  aria-label="chatbot"
>
  <div
    id="Chatbot-content"
    class="bg-white xs:rounded-2xl xs:mx-3 absolute xs:relative w-full h-full xs:w-[400px] flex flex-col overflow-hidden will-change-transform drop-shadow-md"
  >
    <div
      class="bg-gradient-to-br from-primaryOrange from-0% to-customYellow to-100% p-4 flex items-center justify-between relative"
    >
      <div class="flex flex-col w-full gap-4">
        <div class="flex items-center gap-2 w-full">
          <img src="/Frame4.png" alt="" class="size-7" />
          <h6 class="text-white text-xl font-semibold font-Montserrat">
            FAQ Assistant
          </h6>
        </div>
      </div>
      <button
        id="close"
        class="hover:scale-110 duration-300 absolute right-4 top-5"
      >
        <img
          src="/images/icons/close.svg"
          alt="close"
          class="pointer-events-none"
        />
      </button>
    </div>
    <div class="ChatBot-innerContent">
      <div class="chat-section max-h-full" id="chat">
        <!-- Unified container with spacing between messages -->
        <div class="chat-container space-y-4 p-4" id="chat-container">
          <div class="flex flex-row gap-2 items-end w-full">
            <div>
              <img
                src="/icon.webp"
                alt="bot icon"
                class="max-h-7 max-w-5 shrink-0"
              />
            </div>
            <div
              class="bg-lightGray rounded-t-lg rounded-br-lg drop-shadow-md py-2 px-4"
            >
              <p class="chatText">Hello, how can we assist you today?</p>
            </div>
          </div>
          <div class="flex flex-row gap-2 items-end w-full">
            <div>
              <img
                src="/icon.webp"
                alt="bot icon"
                class="max-h-7 max-w-5 shrink-0"
              />
            </div>
            <div
              class="bg-lightGray rounded-t-lg rounded-br-lg drop-shadow-md py-2 px-4"
            >
              <p class="chatText">
                Please choose one of the following options:
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="options-section" id="options-section">
      <!-- Dynamic options content goes here -->
      <div id="options-content"></div>
      <a aria-label="Chat on WhatsApp" href="https://wa.me/966536767272">
        <img src="/images/icons/whatsapp.svg" alt="Chat on WhatsApp" />
      </a>
    </div>
  </div>
  <button
    id="Chatbot-icon"
    class="mt-2 mb-3 mx-3 translate-y-0 transition-transform drop-shadow ease-in-out duration-300 will-change-transform shrink-0 bg-gradient-to-br from-primaryOrange from-0% to-customYellow to-100% size-11 xs:size-14 rounded-full flex items-center justify-center group"
  >
    <img
      src="/Chatbot.svg"
      alt="chatbot"
      class="size-6 xs:size-auto group-hover:scale-110 group-hover:ease-in group-hover:duration-300 translate-y-0.5 duration-300 ease-out will-change-transform pointer-events-none"
    />
  </button>
</div>

<style is:global>
  .ChatBot-innerContent {
    @apply max-h-full flex-1 overflow-y-auto;
    scrollbar-width: thin;
    scroll-behavior: smooth;
  }
  .options-section {
    @apply flex flex-col justify-end gap-4 overflow-hidden border-t border-black/10 p-4;
  }
  .chatText {
    @apply text-sm font-normal leading-6 opacity-90;
  }

  .options-initial {
    @apply flex flex-col gap-2;
  }
  .options-category {
    @apply flex flex-row flex-wrap gap-2;
  }
  .options-question {
    @apply flex flex-col items-start gap-2;
  }

  .option-btn-initial {
    @apply rounded-sm py-2 text-center font-medium leading-normal ring-1 ring-black duration-300 ease-in-out hover:bg-black hover:text-white;
  }
  .option-btn {
    @apply rounded-sm px-2 text-left text-sm font-medium leading-normal ring-1 ring-black duration-300 ease-in-out hover:bg-black hover:text-white;
  }
  .return-btn {
    @apply w-full rounded-sm px-2 text-center font-medium text-primaryOrange ring-1 ring-primaryOrange duration-300 ease-in-out hover:bg-primaryOrange hover:text-white;
  }

  #Chatbot-content {
    @apply origin-bottom-right scale-0 transform opacity-0 transition-[opacity,transform] duration-300 ease-in-out;
  }
  #Chatbot-content.active {
    @apply scale-100 transform opacity-100;
  }

  .chat-bubble {
    @apply relative overflow-hidden rounded-t-lg rounded-br-lg bg-lightGray px-4 py-3 drop-shadow-md;
  }

  .typing-indicator {
    @apply flex gap-2;
  }

  .typing-indicator span {
    @apply size-2 rounded-full bg-gray-400;
    animation: blink 1.5s infinite ease-in-out;
  }

  .typing-indicator span:nth-child(1) {
    animation-delay: 0s;
  }
  .typing-indicator span:nth-child(2) {
    animation-delay: 0.2s;
  }
  .typing-indicator span:nth-child(3) {
    animation-delay: 0.4s;
  }

  @keyframes blink {
    0%,
    80%,
    100% {
      transform: scale(1);
      opacity: 0.3;
    }
    40% {
      transform: scale(1.3);
      opacity: 1;
    }
  }
</style>
<script src="/src/Script/ChatBot.js"></script>
